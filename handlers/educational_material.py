from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from data_bot.materials_dict import MATERIALS  # –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å–ª–æ–≤–∞—Ä—å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
from aiogram import Router, F, types


router = Router()


def get_materials_categories_kb() -> InlineKeyboardMarkup:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ —É—á–µ–±–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.
    """
    buttons = []
    for category in MATERIALS.keys():
        buttons.append([InlineKeyboardButton(
            text=category,
            callback_data=f"material_cat:{category}"
        )])
    buttons.append([InlineKeyboardButton(text="‚¨ÖÔ∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="back_main")])
    return InlineKeyboardMarkup(inline_keyboard=buttons)


def get_material_links_kb(category: str) -> InlineKeyboardMarkup:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
    """
    buttons = []
    for item in MATERIALS[category]:
        buttons.append([InlineKeyboardButton(
            text=item["title"],
            url=item["url"]  # –æ—Ç–∫—Ä—ã—Ç–∏–µ –≤–Ω–µ—à–Ω–µ–π —Å—Å—ã–ª–∫–∏
        )])
    buttons.append([InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data="back_to_materials")])
    return InlineKeyboardMarkup(inline_keyboard=buttons)


@router.message(F.text == "üìö –£—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã")
async def show_materials(message: types.Message):
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —É—á–µ–±–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.
    """
    await message.answer("–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:", reply_markup=get_materials_categories_kb())


@router.callback_query(F.data.startswith("material_cat:"))
async def show_material_links(callback: types.CallbackQuery):
    """
    –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
    """
    category = callback.data.split("material_cat:")[1]
    await callback.message.edit_text(
        f"üìÑ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {category}",
        reply_markup=get_material_links_kb(category)
    )


@router.callback_query(F.data == "back_to_materials")
async def back_to_materials(callback: types.CallbackQuery):
    """
    –í–æ–∑–≤—Ä–∞—Ç –∫ —Å–ø–∏—Å–∫—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π —É—á–µ–±–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.
    """
    await callback.message.edit_text(
        "–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:",
        reply_markup=get_materials_categories_kb()
    )
